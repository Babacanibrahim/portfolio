{% extends "layout.html" %}

{% block title %}Proje Düzenle - Admin{% endblock %}

{% block body %}
<div class="container mt-5">
  <div class="card shadow-sm mx-auto" style="max-width: 700px;">
    <div class="card-header bg-primary text-white">
      <h2 class="mb-0">Projeyi Güncelle</h2>
    </div>
    <div class="card-body">

      {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
          {% for category, message in messages %}
            <div class="alert alert-{{ category }} alert-dismissible fade show" role="alert">
              {{ message }}
              <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
            </div>
          {% endfor %}
        {% endif %}
      {% endwith %}

      <form method="POST" enctype="multipart/form-data" novalidate>
        {{ form.hidden_tag() }}

        <div class="mb-3">
          {{ form.title.label(class="form-label fw-semibold") }}
          {{ form.title(class="form-control form-control-lg", placeholder="Proje başlığı giriniz") }}
          {% for error in form.title.errors %}
            <div class="form-text text-danger">{{ error }}</div>
          {% endfor %}
        </div>

        <div class="mb-3">
          {{ form.description.label(class="form-label fw-semibold") }}
          {{ form.description(class="form-control", rows="5", id="description-editor", placeholder="Proje açıklaması giriniz") }}
          {% for error in form.description.errors %}
            <div class="form-text text-danger">{{ error }}</div>
          {% endfor %}
        </div>

        <div class="mb-3">
          {{ form.github_link.label(class="form-label fw-semibold") }}
          {{ form.github_link(class="form-control", placeholder="GitHub linki (isteğe bağlı)") }}
          {% for error in form.github_link.errors %}
            <div class="form-text text-danger">{{ error }}</div>
          {% endfor %}
        </div>

        <div class="mb-4">
          {{ form.image.label(class="form-label fw-semibold") }}
          {{ form.image(class="form-control") }}
          {% for error in form.image.errors %}
            <div class="form-text text-danger">{{ error }}</div>
          {% endfor %}
          {% if project.image %}
            <div class="mt-2">
              <img src="{{ url_for('static', filename='uploads/' + project.image) }}" alt="Kapak Fotoğrafı" style="max-width: 200px; border: 2px solid #333; border-radius: 8px;">
            </div>
          {% endif %}
        </div>

        <div class="mb-4">
          {{ form.gallery.label(class="form-label fw-semibold") }}
          {{ form.gallery(class="form-control", multiple=true) }}
          {% for error in form.gallery.errors %}
            <div class="form-text text-danger">{{ error }}</div>
          {% endfor %}

          {% if project.images %}
            <div class="mt-3 d-flex flex-wrap gap-3">
              {% for img in project.images %}
                <div style="position: relative; display: inline-block;">
                  <img src="{{ url_for('static', filename='uploads/' + img.filename) }}" alt="Galeri Fotoğrafı" 
                       style="max-width: 120px; border-radius: 6px; box-shadow: 0 0 5px #ccc; border: 2px solid #adb5bd;">
                  <label style="position: absolute; top: 4px; right: 4px; background: rgba(255,255,255,0.8); border-radius: 50%; padding: 2px 6px; cursor: pointer; border: 1px solid #dc3545; color: #dc3545; font-weight: bold; user-select: none;">
                    <input type="checkbox" name="delete_images" value="{{ img.id }}">
                    X
                  </label>
                </div>
              {% endfor %}
            </div>
          {% endif %}
        </div>

        <button type="submit" class="btn btn-primary btn-lg w-100">
          {{ form.submit.label.text if form.submit.label else 'Projeyi Güncelle' }}
        </button>
      </form>

      <!-- Silme Formu -->
      <form method="POST" action="{{ url_for('delete', id=project.id) }}" onsubmit="return confirm('Projeyi silmek istediğinize emin misiniz?');" class="mt-3">
        <button type="submit" class="btn btn-danger w-100">Projeyi Sil</button>
      </form>

    </div>
  </div>
</div>

<script>
  CKEDITOR.replace('description-editor');
</script>

{% endblock %}